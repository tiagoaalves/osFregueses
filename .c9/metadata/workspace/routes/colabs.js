{"filter":false,"title":"colabs.js","tooltip":"/routes/colabs.js","undoManager":{"mark":3,"position":3,"stack":[[{"start":{"row":10,"column":0},"end":{"row":11,"column":130},"action":"remove","lines":["const CREATE_USER_SQL = 'INSERT INTO users SET ?';","const UPDATE_USER_SQL = 'INSERT INTO utilizador SET nome=?, email=?, idade=?, sexo=?, morada=?, password=? WHERE id_utilizador=?';"],"id":2}],[{"start":{"row":12,"column":0},"end":{"row":22,"column":3},"action":"remove","lines":["router.get('/admins', function(req, res) {","  global.connection.query(GET_ALL_USERS_SQL, [\"Administrador\"], function(error, results, fields) {","    if (error) {","      res.status(500).json({ error: error, response: null }); ","    } else if (results.length == 0) {","      res.status(204).json({ error: null, response: results });","    } else {","      res.status(200).json({ error: null, response: results });","    }","  });","});"],"id":3},{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"remove","lines":["",""]},{"start":{"row":10,"column":0},"end":{"row":11,"column":0},"action":"remove","lines":["",""]},{"start":{"row":9,"column":195},"end":{"row":10,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":35,"column":0},"end":{"row":83,"column":3},"action":"remove","lines":["router.post('/admins', function(req, res) {","      console.log(req.body);","      console.log(\"routeadmins\");","      const id_utilizador = req.body.id_utilizador;","      const nome = req.body.nome;","      const idade = req.body.idade;","      const sexo = req.body.sexo;","      const morada = req.body.morada;","      const password = req.body.password;","      const email = req.body.email;","      console.log(\"without hahsh:\" + req.headers.password);","      var query = \"\";","      bcrypt.hash(password, saltRounds).then(function (hash) {","      var post = {","      id_utilizador : id_utilizador,","      nome: nome,","      email: email,","      password: hash,","      idade : idade,","      sexo : sexo,","      morada : morada,","      cargo : 'Administrador',","      };","      console.log(\"with hash:\" + hash);","      query = global.connection.query('INSERT INTO utilizador SET ?', post, function (err, rows, fields) {","      console.log(query.sql);","      if (!err) {","      res.status(200).location(rows.insertId).send({","      \"msg\": \"inserted with success\"","      });","      console.log(\"Number of records inserted: \" + rows.affectedRows);","      } else {","      if (err.code == \"ER_DUP_ENTRY\") {","        res.status(409).send({\"msg\": err.code});","        console.log('Error while performing Query.', err);","        global.connection.query('error', function(err) {","              console.log(\"[mysql error]\",err);","            });","      } else {","      res.status(400).send({\"msg\": err.code});","      global.connection.query('error', function(err) {","              console.log(\"[mysql error]\",err);","            });","      }","      }","    });","});","","});"],"id":4},{"start":{"row":34,"column":0},"end":{"row":35,"column":0},"action":"remove","lines":["",""]},{"start":{"row":33,"column":3},"end":{"row":34,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":145,"column":0},"end":{"row":193,"column":3},"action":"remove","lines":["router.put('/:user', function(req, res) {","      console.log(req.body);","      console.log(\"routeupdate\");","      const id_utilizador = req.body.id_utilizador;","      const nome = req.body.nome;","      const idade = req.body.idade;","      const sexo = req.body.sexo;","      const morada = req.body.morada;","      const password = req.body.password;","      const email = req.body.email;","      const cargo = \"Administrador\";","      console.log(\"without hahsh:\" + req.headers.password);","      var query = \"\";","      bcrypt.hash(password, saltRounds).then(function (hash) {","      var update = {","      nome,","      email,","      hash,","      idade,","      sexo,","      morada,","      cargo,","      id_utilizador,","      };","      console.log(\"with hash:\" + hash);","      query = global.connection.query(`UPDATE utilizador SET nome = '${nome}', email ='${email}', password='${hash}', idade=${idade}, sexo='${sexo}', morada = '${morada}', cargo='${cargo}' WHERE id_utilizador=${id_utilizador}`, function (err, rows, fields) {","      console.log(query.sql);","      if (!err) {","      res.status(200).location(rows.insertId).send({","      \"msg\": \"Updated with success\"","      });","      console.log(\"Number of records inserted: \" + rows.affectedRows);","      } else {","      if (err.code == \"ER_DUP_ENTRY\") {","        res.status(409).send({\"msg\": err.code});","        console.log('Error while performing Query.', err);","        global.connection.query('error', function(err) {","              console.log(\"[mysql error]\",err);","            });","      } else {","      res.status(400).send({\"msg\": err.code});","      global.connection.query('error', function(err) {","              console.log(\"[mysql error]\",err);","            });","      }","      }","    });","});","});"],"id":5},{"start":{"row":144,"column":0},"end":{"row":145,"column":0},"action":"remove","lines":["",""]},{"start":{"row":143,"column":3},"end":{"row":144,"column":0},"action":"remove","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":1},"end":{"row":0,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1546099921291,"hash":"6297b1b4893a8d4e6c472a3e990d0c6926202ec4"}